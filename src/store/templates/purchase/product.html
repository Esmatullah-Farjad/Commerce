{% extends '_base.html' %}
{% load i18n %}
{% load static %}
{% load humanize %}
{% load custom_filters %}

{% block title %}{% trans 'Products' %}{% endblock title %}

{% block content %}
<div class="space-y-4">

  <!-- Header / Actions -->
  <div class="rounded-2xl border border-slate-200 bg-white px-6 py-5 shadow-sm">
    <div class="flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between">

      <!-- Title -->
      <div class="flex items-start gap-3">
        <div class="mt-0.5 flex h-10 w-10 items-center justify-center rounded-xl bg-teal-50 ring-1 ring-inset ring-teal-600/15">
          <svg class="h-5 w-5 text-teal-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.8"
              d="M20 12H4m16 0a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2v-6a2 2 0 012-2m16 0V9a2 2 0 00-2-2M4 12V9a2 2 0 012-2h12a2 2 0 012 2v3" />
          </svg>
        </div>

        <div>
          <div class="flex flex-wrap items-center gap-2">
            <h2 class="text-xl font-semibold text-slate-900 leading-tight">
              {% trans 'Available Products' %}
            </h2>
            <span class="inline-flex items-center rounded-full bg-teal-50 px-2.5 py-0.5 text-xs font-semibold text-teal-700 ring-1 ring-inset ring-teal-600/15">
              {% trans 'Inventory' %}
            </span>
          </div>
          <p class="mt-1 text-sm text-slate-600 max-w-2xl">
            {% trans 'Browse products, view pricing, and check availability.' %}
          </p>
        </div>
      </div>

      <!-- Actions -->
      <div class="flex flex-col sm:flex-row sm:items-center gap-2">
        <!-- Filters (tabs style) -->
        <div class="inline-flex rounded-xl border border-slate-200 bg-slate-50 p-1">
          <a
            href="{% url 'products_display' %}"
            class="rounded-lg px-3.5 py-2 text-sm font-semibold {% if currency_filter == 'all' or not currency_filter %}bg-white text-slate-900 shadow-sm{% else %}text-slate-700 hover:text-slate-900{% endif %}"
          >
            {% trans 'All' %} ({{ usd_count|add:afn_count }})
          </a>
          <a
            href="{% url 'products_display' %}?currency=usd"
            class="rounded-lg px-3.5 py-2 text-sm font-semibold {% if currency_filter == 'usd' %}bg-white text-slate-900 shadow-sm{% else %}text-slate-700 hover:text-slate-900{% endif %}"
          >
            {% trans 'Dollar Goods' %} ({{ usd_count }})
          </a>
          <a
            href="{% url 'products_display' %}?currency=afn"
            class="rounded-lg px-3.5 py-2 text-sm font-semibold {% if currency_filter == 'afn' %}bg-white text-slate-900 shadow-sm{% else %}text-slate-700 hover:text-slate-900{% endif %}"
          >
            {% trans 'Afghani Goods' %} ({{ afn_count }})
          </a>

          
        </div>

        <!-- Primary CTA -->
        {% if can_transfer %}
          <a
            href="{% url 'transfer-inventory' %}"
            class="inline-flex items-center justify-center gap-2 rounded-xl border border-slate-200 bg-white px-4 py-2.5 text-sm font-semibold text-slate-700 hover:bg-slate-50"
          >
            <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.8" d="M7 7h10M7 7l3-3m-3 3l3 3M17 17H7m10 0l-3-3m3 3l-3 3" />
            </svg>
            {% trans 'Transfer Stock' %}
          </a>
        {% endif %}
        <a
          href="{% url 'purchase' %}"
          class="inline-flex items-center justify-center gap-2 rounded-xl bg-teal-700 px-4 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-teal-800 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-offset-2"
        >
          <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.8" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
          </svg>
          {% trans 'New Purchase' %}
        </a>
      </div>
    </div>
  </div>

  {% if currency_filter == 'usd' %}
  <div class="rounded-2xl border border-amber-200 bg-amber-50 px-6 py-4 shadow-sm">
    <div class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
      <div>
        <h3 class="text-sm font-semibold text-amber-900">{% trans 'USD Exchange Rate' %}</h3>
        <p class="text-xs text-amber-700">
          {% trans 'Used to convert USD-priced products into AFN pricing.' %}
        </p>
      </div>
      <div class="text-xs font-semibold text-amber-900">
        {% trans 'Current' %}: {{ exchange_rate.usd_to_afn|default:"â€”" }}
      </div>
    </div>
    <form method="post" action="{% url 'products_display' %}?currency=usd" class="mt-3 flex flex-col gap-2 sm:flex-row sm:items-center">
      {% csrf_token %}
      <div class="w-full sm:max-w-xs">
        {{ exchange_form.usd_to_afn }}
      </div>
      <button
        type="submit"
        class="inline-flex items-center justify-center rounded-lg bg-amber-600 px-4 py-2 text-sm font-semibold text-white hover:bg-amber-700"
      >
        {% trans 'Update Rate' %}
      </button>
    </form>
  </div>
  {% endif %}

  {% include 'partials/product_list.html' %}
</div>
{% endblock %}
