
{% load i18n %}
{% load static %}
{% load humanize %}
{% load custom_filters %}

<div class="rounded-3xl border border-slate-200 bg-white p-6 shadow-sm">
    {% if cart_details %}
    <div class="grid gap-3 rounded-2xl border border-slate-100 bg-slate-50 p-4 text-sm text-slate-600 sm:grid-cols-3">
        <div><strong class="text-slate-700">{% trans 'Full Name' %}: </strong>{{customer.name}}</div>
        <div><strong class="text-slate-700">{% trans 'Phone' %}: </strong>{{customer.phone}}</div>
        <div><strong class="text-slate-700">{% trans 'Address' %}: </strong>{{customer.address}}</div>
    </div>
    <div class="mt-6 space-y-6">
        <div class="overflow-x-auto rounded-2xl border border-slate-200">
            <table class="min-w-full text-left text-sm" id="product-cart-table">
                <thead class="bg-slate-900 text-xs uppercase tracking-wide text-primary-100">
                    <tr>
                        <th class="px-4 py-3">{% trans 'Image' %}</th>
                        <th class="px-4 py-3" style="width:200px">{% trans 'Name' %}</th>
                        <th class="px-4 py-3">{% trans 'Quantity' %}</th>
                        <th class="px-4 py-3">{% trans 'Package' %}</th>
                        <th class="px-4 py-3">{% trans 'Item Price' %}</th>
                        <th class="px-4 py-3">{% trans 'Package Price' %}</th>
                        <th class="px-4 py-3">{% trans 'Total' %}</th>
                        <th class="px-4 py-3">{% trans 'Action' %}</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-slate-100">
                    {% for item in cart_details %}
                    <tr class="hover:bg-slate-50" 
                    data-product-id={{item.product.id}}
                    data-end-point-url={% url 'add-to-cart' %}>
                        <td class="px-4 py-3">
                            <img src="{{item.product.image.url}}" alt="image" class="h-10 w-10 rounded-xl object-cover">
                        </td>
                        <td class="px-4 py-3" style="width:200px">{{item.product.name}}</td>
                        <td class="px-4 py-3">
                            <select name="quantity" class="select-input item-quantity w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-xs text-slate-700">
                                <option value="" selected>{% trans '--select--' %}</option>
                                {% for i in item.product.package_contain|range_filter %}
                                    <option value="{{ i }}" {% if i == item.item_quantity %} selected {% endif %}>{{ i }}</option>
                                {% endfor %}
                            </select>
                        </td>
                        <td class="px-4 py-3">
                            <select name="package" class="select-input package-quantity w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-xs text-slate-700">
                                <option value="" selected>{% trans '--select--' %}</option>
                                {% for i in item.product.num_of_packages|range_filter %}
                                    <option value="{{ i }}" {% if i == item.package_quantity %}selected{% endif %}>{{ i }}</option>
                                {% endfor %}
                            </select>
                        </td>
                        <td class="px-4 py-3"><input type="number" class="table-input item-price w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-xs text-slate-700" value={{ item.item_price|default:item.product.item_sale_price }}></td>
                        <td class="px-4 py-3"><input type="number" class="table-input package-price w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-xs text-slate-700" value={{item.package_price|default:item.product.package_sale_price}}></td>
                        
                        <td class="px-4 py-3 text-slate-600">{{ item.sub_total|intcomma }}</td>
                        <td class="px-4 py-3">
                            <a 
                            href="{% url 'remove-cart-item' item.product.id %}"
                            class="text-xs font-semibold text-rose-600 transition hover:text-rose-500">
                                {% trans 'Delete' %}
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                    <tr class="bg-white text-xs">
                        <td colspan="3" class="px-4 py-3">
                            <p class="text-slate-600">
                                {% trans 'Total' %}: <b>{{total|intcomma}} {% trans 'AFN' %}</b>
                            </p>
                            <p class="text-slate-600">
                                {% trans 'Pre Unpaid Amound' %}: <b>{{pre_unpaid_amount|intcomma}} {% trans 'AFN' %}</b>
                            </p>
                        </td>
                        <td colspan="5"></td>
                    </tr>
                    <tr class="bg-white text-sm font-semibold">
                        <td colspan="3" class="px-4 py-3">{% trans 'Grand Total' %}: </td>
                        <td colspan="5" class="px-4 py-3 text-slate-900">{{grand_total|intcomma}} {% trans 'AFN' %}</td>
                    </tr>
                    
                </tbody>
            </table>
        </div>
        <div class="rounded-2xl border border-slate-200 bg-slate-50 p-4">
            <form action="{% url 'cart-view' %}" method="post" class="grid gap-4 sm:grid-cols-3">
                {% csrf_token %}
                <div class="space-y-2">
                    <label for="paid" class="text-sm font-medium text-slate-600">{% trans 'Paid Amount' %}</label>
                    <input type="number" class="input-field w-full rounded-xl border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 shadow-sm focus:border-primary-500 focus:ring-2 focus:ring-primary-200" id="paid" name="paid">
                </div>
                <div class="space-y-2">
                    <label for="unpaid" class="text-sm font-medium text-slate-600">{% trans 'Unpaid Amount' %}</label>
                    <input type="number" class="input-field w-full rounded-xl border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 shadow-sm focus:border-primary-500 focus:ring-2 focus:ring-primary-200" name="unpaid" id="unpaid">
                </div>
                <div class="flex items-end">
                    <button type="submit" class="w-full rounded-xl bg-slate-900 px-4 py-2 text-sm font-semibold text-white transition hover:bg-slate-800">{% trans 'Sale' %}</button>
                </div>
            </form>
        </div>
    </div>
    
    {% else %}
    <div class="flex flex-col items-center justify-center gap-3 rounded-2xl border border-dashed border-slate-300 bg-slate-50 p-10 text-center">
        <img class="h-24 w-24 rounded-full object-cover" src="{% static 'image/empty.jpg' %}" alt="">
        <p class="text-lg font-semibold text-slate-800">{% trans 'Your Cart is Empty' %}</p>
        <p class="text-sm text-slate-500">{% trans "Looks like you haven't added anything yet. " %}
            <a href="{% url 'products-view' %}" class="font-semibold text-primary-600 transition hover:text-primary-500">{% trans "Let's start shopping!" %}</a>
        </p>
    </div>
    {% endif %}
</div>

<script src="{% static 'js/cart.js' %}"></script>
<script>
    const paidInput = document.querySelector('#paid');
    if (paidInput) {
        paidInput.addEventListener("input", (e) => {
            let paid = e.target.value;
            let total = {{grand_total}};
            let unpaid = total - paid;
            document.getElementById('unpaid').value = unpaid;
        });
    }
</script>
