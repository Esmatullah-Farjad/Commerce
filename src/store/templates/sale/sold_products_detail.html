{% extends '_base.html' %}
{% load i18n %}
{% load static %}
{% load humanize %}
{% load jalali_tags %}
{% load custom_filters %}
{% block title %}
    {% trans "Sales Summary" %}
{% endblock title %}
{% block content %}
<div class="space-y-6">
    <div class="flex flex-col gap-4 rounded-3xl border border-slate-200 bg-white/80 p-6 shadow-sm sm:flex-row sm:items-center sm:justify-between">
        <div>
            <h2 class="text-2xl font-semibold text-slate-900">{% trans 'Sales Summary' %}</h2>
            <p class="text-sm text-slate-500">{% trans 'Review the sale details and item breakdown' %}</p>
        </div>
        <a href="{% url 'print-invoice' sales_info.bill_number %}" class="rounded-xl bg-primary-500 px-4 py-2 text-sm font-semibold text-slate-900 shadow-sm transition hover:bg-primary-400">{% trans 'Print' %}</a>
    </div>
    <div class="grid gap-4 rounded-3xl border border-slate-200 bg-white p-6 text-sm text-slate-600 shadow-sm sm:grid-cols-2 lg:grid-cols-3">
        <div><strong class="text-slate-700">{% trans 'Bill Number' %} :</strong> {{sales_info.bill_number}}</div>
        <div><strong class="text-slate-700">{% trans 'Full Name' %} :</strong> {{sales_info.customer.name}}</div>
        <div><strong class="text-slate-700">{% trans 'Address' %} :</strong> {{sales_info.customer.address}}</div>
        <div><strong class="text-slate-700">{% trans 'Phone' %} :</strong> {{sales_info.customer.phone}}</div>
        <div><strong class="text-slate-700">{% trans 'Date' %} :</strong> {{sales_info.created_at|jalali}}</div>
        <div><strong class="text-slate-700">{% trans 'Total Amount' %} :</strong> {{sales_info.total_amount}}</div>
        <div><strong class="text-slate-700">{% trans 'Paid Amount' %} :</strong> {{sales_info.paid_amount}}</div>
        <div><strong class="text-slate-700">{% trans 'Unpaid Amount' %} :</strong> {{sales_info.unpaid_amount}}</div>
    </div>
    <div class="overflow-x-auto rounded-2xl border border-slate-200 bg-white shadow-sm">
        <table class="min-w-full text-left text-sm">
            <thead class="bg-slate-900 text-xs uppercase tracking-wide text-primary-100">
                <tr>
                    <th class="px-4 py-3">{% trans 'Name' %}</th>
                    <th class="px-4 py-3">{% trans 'Item price' %}</th>
                    <th class="px-4 py-3">{% trans 'Package price' %}</th>
                    <th class="px-4 py-3">{% trans 'Item quantity' %}</th>
                    <th class="px-4 py-3">{% trans 'Package quantity' %}</th>
                    <th class="px-4 py-3">{% trans 'Total price' %}</th>
                    <th class="px-4 py-3">{% trans 'Action' %}</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-slate-100">
                {% if sales_products %}
                {% for data in sales_products %}
                <tr class="hover:bg-slate-50">
                    <td class="px-4 py-3 font-medium text-slate-900">{{data.product.name}}</td>
                    <td class="px-4 py-3">{{data.item_price}}</td>
                    <td class="px-4 py-3">{{data.package_price}}</td>
                    <td class="px-4 py-3">{{data.item_qty}}</td>
                    <td class="px-4 py-3">{{data.package_qty}}</td>
                    <td class="px-4 py-3">{{data.total_price}}</td>
                    <td class="px-4 py-3">
                        <a class="inline-flex items-center gap-2 rounded-xl border border-primary-200 px-3 py-2 text-xs font-semibold text-primary-600 transition hover:bg-primary-50"
                        hx-get="{% url 'return-items' data.id %}" 
                        hx-target="closest tr" 
                        hx-swap="outerHTML swap:0.3s"
                        hx-confirm="{% trans 'Are you sure you want to return this item?' %}"
                        hx-on="returnSuccess: showSuccess()">
                            {% trans "Return" %}
                            <svg xmlns="http://www.w3.org/2000/svg" 
                            fill="none" viewBox="0 0 24 24" 
                            stroke-width="1.5" stroke="currentColor" class="h-4 w-4">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9 15 3 9m0 0 6-6M3 9h12a6 6 0 0 1 0 12h-3" />
                            </svg>
                        </a>
                    </td>
                </tr>
                {% endfor %}
                {% else %}
                <tr>
                    <td colspan="6" class="px-4 py-10">
                        <div class="flex flex-col items-center gap-3 text-center">
                            <img class="h-20 w-20 rounded-full object-cover" src="{% static 'image/empty.jpg' %}" alt="">
                            <p class="text-lg font-semibold text-slate-800">{% trans 'No items found' %}</p>
                            <a href="{% url 'sold-products-view' %}" class="text-sm font-semibold text-primary-600">{% trans "Go back" %}</a>
                        </div>
                    </td>
                </tr>
                {% endif %}

            </tbody>
        </table>
    </div>
</div>
<script>
    function showSuccess() {
        alert('Return processed successfully!');
    }
</script>
{% endblock content%}